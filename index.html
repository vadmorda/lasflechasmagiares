<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Lanzas del Danubio – Juego de Flechas (modo experto)</title>
<style>
  :root{ --bg:#f5e9cf; --ink:#3c2f2f; --accent:#8b5e34; --good:#2f6f3e; --bad:#8b2f2f; }
  html,body{margin:0;height:100%;background:var(--bg);color:var(--ink);font-family:Georgia,"Times New Roman",serif;}

  /* Pantalla de inicio */
  #loginScreen {position:fixed;inset:0;background:var(--bg);display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:10;}
  #loginBox {border:6px double var(--accent);border-radius:12px;padding:2rem 3rem;background:linear-gradient(rgba(255,255,255,.1), rgba(0,0,0,.05));box-shadow:0 10px 30px rgba(0,0,0,.2);text-align:center;}
  #loginBox h2{color:var(--accent);margin-bottom:1rem}
  #claveInput {padding:.4rem .6rem;border:2px solid var(--accent);border-radius:8px;font-size:1rem;margin-right:.5rem;}
  #btnEntrar {background:var(--accent);color:#fff;border:none;padding:.45rem .9rem;border-radius:8px;cursor:pointer;font-weight:bold;}
  #msgError {color:var(--bad);margin-top:.75rem;display:none;font-weight:bold;}

  .page{min-height:100vh;display:flex;flex-direction:column;align-items:center;gap:1rem;
    background:radial-gradient(ellipse at top left, rgba(0,0,0,.06), transparent 60%),
               radial-gradient(ellipse at bottom right, rgba(0,0,0,.05), transparent 60%),
               repeating-linear-gradient(90deg, rgba(0,0,0,.03) 0 1px, transparent 1px 8px), var(--bg);
    padding:1.25rem;}
  .frame{width:min(1000px,95vw);border:6px double var(--accent);border-radius:12px;padding:1rem 1rem 1.25rem;
    box-shadow:0 10px 30px rgba(0,0,0,.15), inset 0 0 60px rgba(139,94,52,.15);
    background:linear-gradient(rgba(255,255,255,.05), rgba(0,0,0,.05)), var(--bg);}  
  h1{text-align:center;color:var(--accent);margin:.25rem 0}
  .subtitle{text-align:center;font-style:italic;margin:.25rem 0 1rem}
  .topbar{display:flex;gap:.75rem;justify-content:center;align-items:center;flex-wrap:wrap}
  .board{--size:6;display:grid;gap:.4rem;justify-content:center;margin:.5rem auto 1rem;
    grid-template-columns:repeat(var(--size), min(64px, calc((90vw - 6rem)/var(--size))));}
  .cell{aspect-ratio:1/1;background:#f3e3bf;border:2px solid rgba(60,47,47,.4);border-radius:10px;
    display:flex;align-items:center;justify-content:center;font-size:clamp(18px,4vw,24px);
    box-shadow:inset 0 0 14px rgba(0,0,0,.1);user-select:none;transition:.12s;padding:.25rem;cursor:pointer}
  .start{outline:3px solid var(--good)!important}
  .goal{outline:3px solid var(--accent)!important}
  .path{background:#efe0ba;}
  .good { background:#b8f5bf!important; border:3px solid #138a26!important; color:#0f4d14!important; animation: aciertoPulse 0.8s ease-in-out; }
  .bad { background:#ffb3b3!important; border:3px solid #b30000!important; animation: errorShake .4s ease-in-out; }
  @keyframes aciertoPulse {0%{transform:scale(1)}50%{transform:scale(1.08)}100%{transform:scale(1)}}
  @keyframes errorShake {0%,100%{transform:translateX(0)}25%{transform:translateX(4px)}50%{transform:translateX(-4px)}75%{transform:translateX(3px)}}
  .legend{max-width:900px;margin:.25rem auto 0;font-size:.95rem;line-height:1.35}
  .chips{display:flex;gap:.5rem;justify-content:center;flex-wrap:wrap;margin:.5rem 0}
  .chip{background:#f0d8b2;border:1px solid rgba(60,47,47,.35);padding:.25rem .5rem;border-radius:999px;font-size:.9rem}
  .muted{opacity:.8}
  .secret{display:none;margin-top:1rem;text-align:center;font-weight:bold;color:var(--good)}
  .secret.show{display:block}
</style>
</head>
<body>
<div id="loginScreen">
  <div id="loginBox">
    <h2>Acceso a LAS FLECHAS MAGIARES</h2>
    <p>Introduce la clave secreta para acceder al juego:</p>
    <input id="claveInput" type="password" placeholder="Clave" />
    <button id="btnEntrar">Entrar</button>
    <div id="msgError">Clave incorrecta. Inténtalo de nuevo.</div>
  </div>
</div>

<div class="page" id="gameScreen" style="display:none">
  <div class="frame">
    <h1>Lanzas del Danubio</h1>
    <p class="subtitle">Modo experto: algunas casillas usan <b>símbolos o números</b> en lugar de flechas.</p>

    <div class="topbar">
      <button id="btnReset" type="button" class="chip">Reiniciar</button>
      <span class="chip muted" id="movesInfo">Movimientos: 0</span>
    </div>

    <div id="board" class="board"></div>
    <div class="legend" id="legendBox"></div>
    <div class="chips" id="symbolLegend"></div>
    <p class="secret" id="secretCode"></p>
  </div>
</div>

<script>
// Pantalla de inicio
const loginScreen=document.getElementById('loginScreen');
const gameScreen=document.getElementById('gameScreen');
const btnEntrar=document.getElementById('btnEntrar');
const claveInput=document.getElementById('claveInput');
const msgError=document.getElementById('msgError');

btnEntrar.addEventListener('click',()=>{
  if(claveInput.value.trim().toLowerCase()==='magiar'){
    loginScreen.style.display='none';
    gameScreen.style.display='block';
    build();
  }else{
    msgError.style.display='block';
    claveInput.value='';
    claveInput.focus();
  }
});

/* === Código original del juego === */
const LEVEL={size:6,start:[0,0],goal:[5,5],code:"168.",cells:[[{type:'arrows',dir:'E',steps:2},{type:'symbol',dir:'S',steps:3},{type:'alpha',dir:'E',steps:1},{type:'symbol',dir:'S',steps:2},{type:'alpha',dir:'E',steps:1},{type:'symbol',dir:'S',steps:1}],[{type:'alpha',dir:'E',steps:1},{type:'symbol',dir:'E',steps:2},{type:'arrows',dir:'S',steps:1},{type:'alpha',dir:'E',steps:1},{type:'symbol',dir:'S',steps:2},{type:'arrows',dir:'S',steps:2}],[{type:'symbol',dir:'S',steps:1},{type:'arrows',dir:'E',steps:1},{type:'alpha',dir:'E',steps:2},{type:'symbol',dir:'S',steps:1},{type:'arrows',dir:'E',steps:1},{type:'alpha',dir:'S',steps:1}],[{type:'alpha',dir:'E',steps:1},{type:'symbol',dir:'S',steps:1},{type:'arrows',dir:'E',steps:1},{type:'alpha',dir:'E',steps:1},{type:'symbol',dir:'S',steps:1},{type:'arrows',dir:'E',steps:1}],[{type:'arrows',dir:'S',steps:1},{type:'alpha',dir:'E',steps:2},{type:'symbol',dir:'E',steps:1},{type:'arrows',dir:'S',steps:1},{type:'symbol',dir:'E',steps:1},{type:'alpha',dir:'S',steps:1}],[{type:'symbol',dir:'E',steps:1},{type:'alpha',dir:'E',steps:1},{type:'arrows',dir:'E',steps:1},{type:'symbol',dir:'E',steps:1},{type:'alpha',dir:'E',steps:1},{type:'arrows',dir:'N',steps:1}]]};

function A(d,s){return{type:'arrows',dir:d,steps:s}}function AL(d,s){return{type:'alpha',dir:d,steps:s}}function SY(d,s){return{type:'symbol',dir:d,steps:s}}
const ARROWS={N:'↑',E:'→',S:'↓',O:'←'};const DIR_LETTER={N:'N',E:'E',S:'S',O:'O'};const SYMBOL_POOL=['☼','☁','☂','☾','★','◆','♣','♠'];let SYMBOL_MAP;
const board=document.getElementById('board'),secret=document.getElementById('secretCode'),legendBox=document.getElementById('legendBox'),symbolLegend=document.getElementById('symbolLegend'),movesInfo=document.getElementById('movesInfo'),btnReset=document.getElementById('btnReset');
const sonidoAcierto=new Audio('acierto.mp3');const sonidoError=new Audio('error.mp3');sonidoAcierto.volume=.4;sonidoError.volume=.4;let state={r:0,c:0,path:[],locked:false,moves:0};
btnReset&&btnReset.addEventListener('click',()=>build());
function build(){
  const pool=[...SYMBOL_POOL];
  shuffle(pool);
  SYMBOL_MAP={N:pool[0],E:pool[1],S:pool[2],O:pool[3]};

  // 🔒 Eliminamos las pistas y la leyenda
  legendBox.innerHTML = '';
  symbolLegend.innerHTML = '';

  board.style.setProperty('--size',LEVEL.size);
  board.innerHTML='';
  state={r:LEVEL.start[0],c:LEVEL.start[1],path:[[LEVEL.start[0],LEVEL.start[1]]],locked:false,moves:0};
  secret.classList.remove('show');
  secret.textContent='';
  movesInfo.textContent=`Movimientos:${state.moves}`;

  for(let r=0;r<LEVEL.size;r++){
    for(let c=0;c<LEVEL.size;c++){
      const cell=document.createElement('button');
      cell.type='button';
      cell.className='cell';
      cell.dataset.r=r;
      cell.dataset.c=c;

      const {type,dir,steps}=LEVEL.cells[r][c];
      cell.textContent=renderToken(type,dir,steps);

      board.appendChild(cell);
    }
  }
  paint();
}

function renderToken(t,d,s){if(t==='arrows')return ARROWS[d].repeat(s);if(t==='alpha')return`${s}${DIR_LETTER[d]}`;if(t==='symbol')return`${SYMBOL_MAP[d]}${s}`;return'?'}
function paint(){Array.from(board.children).forEach(c=>{c.classList.remove('start','goal','path','bad','good');c.removeAttribute('data-correct')});get(LEVEL.start[0],LEVEL.start[1]).classList.add('start');get(LEVEL.goal[0],LEVEL.goal[1]).classList.add('goal');for(const [r,c] of state.path)get(r,c).classList.add('path');const[cr,cc]=destFrom(state.r,state.c);if(within(cr,cc))get(cr,cc).dataset.correct='1';Array.from(board.children).forEach(cell=>{cell.onclick=()=>{if(state.locked)return;const r=+cell.dataset.r,c=+cell.dataset.c;if(cell.dataset.correct==='1'){sonidoAcierto.currentTime=0;sonidoAcierto.play();cell.classList.add('good');setTimeout(()=>{state.r=r;state.c=c;state.path.push([r,c]);state.moves++;movesInfo.textContent=`Movimientos:${state.moves}`;if(r===LEVEL.goal[0]&&c===LEVEL.goal[1])return win();paint()},600)}else{sonidoError.currentTime=0;sonidoError.play();cell.classList.add('bad');setTimeout(()=>cell.classList.remove('bad'),400)}}})}
function get(r,c){return board.children[r*LEVEL.size+c]}function destFrom(r,c){const{dir,steps}=LEVEL.cells[r][c];let rr=r,cc=c;if(dir==='N')rr-=steps;if(dir==='S')rr+=steps;if(dir==='E')cc+=steps;if(dir==='O')cc-=steps;return[rr,cc]}function within(r,c){return r>=0&&r<LEVEL.size&&c>=0&&c<LEVEL.size}function dCompleta(d){return d==='N'?'Norte':d==='E'?'Este':d==='S'?'Sur':'Oeste'}function shuffle(a){for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]]}return a}function win(){state.locked=true;secret.textContent='Código:'+LEVEL.code;secret.classList.add('show')}
</script>
</body>
</html>
